<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.bagStrap.mapper.CSCenterMapper">
	
	<select id="searchList" parameterType="hashmap" resultType="com.example.bagStrap.model.StudyComm">
		select s.*, c.*,u.*,b.*,
		 CASE
    		WHEN TRUNC(s.created_date) = TRUNC(SYSDATE) THEN TO_CHAR(s.created_date, 'HH24:MI:SS')
    		ELSE TO_CHAR(s.created_date, 'YYYY-MM-DD')
   			END AS createdDateFormatted,
   			NVL(c.cnt, 0) AS cnt
		from tbl_stu_comm s
		inner join tbl_user u on s.author=u.user_id
		LEFT JOIN (
		    SELECT post_id, COUNT(comment_id) AS cnt
		    FROM tbl_stu_comments
		    GROUP BY post_id
		) c ON s.board_id = c.post_id
		inner join tbl_stu_comm_board_types b on b.board_type_id=s.board_type
		WHERE 1=1
		<if test="category !='' and category !=null">
			and b.board_type_id= #{category}
		</if>
		<if test="searchOption == 'all'">
			and (s.title LIKE '%' || #{keyword} || '%'
			or u.user_nickname LIKE '%' || #{keyword} || '%')
		</if>
		<if test="searchOption == 'title'">
			and s.title LIKE '%' || #{keyword} || '%'
		</if>
		<if test="searchOption == 'name'">
			 and u.user_nickname LIKE '%' || #{keyword} || '%'
		</if>
		<!--where board_type=1002-->
		order by s.created_date desc
	</select>
</mapper>